___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "type": "TAG",
  "id": "cvt_temp_public_id",
  "version": 1,
  "securityGroups": [],
  "displayName": "Instant Recall Widget",
  "categories": ["EMAIL_MARKETING"],
  "brand": {
    "id": "brand_missena",
    "displayName": "Missena",
    "thumbnail": "data:image/png;base64,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"
  },
  "description": "Instant Recall Widget Integration Template",
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "type": "TEXT",
    "name": "merchantKey",
    "displayName": "Merchant Key",
    "simpleValueType": true
  },
  {
    "type": "SELECT",
    "name": "pageData",
    "displayName": "Page Data Variable",
    "macrosInSelect": true,
    "selectItems": [],
    "simpleValueType": true
  },
  {
    "type": "CHECKBOX",
    "name": "isDev",
    "checkboxText": "Is Dev",
    "simpleValueType": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// Enter your template code here. 
const setInWindow = require('setInWindow');
const log = require('logToConsole');
const injectScript = require('injectScript');
const encodeUriComponent = require('encodeUriComponent');

function irScrapper(){ return data.pageData;}
const apiUrl = data.isDev? 'https://api-ir.staging.missena.xyz/?t=' : 'https://api.instantrecall.me/?t=';
const url = apiUrl+encodeUriComponent(data.merchantKey)+'&locale='+encodeUriComponent(data.pageData.locale);

setInWindow('irScrapper', irScrapper, true); 
injectScript(url, data.gtmOnSuccess, data.gtmOnFailure); 

// Call data.gtmOnSuccess when the tag is finished.
data.gtmOnSuccess();


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "irScrapper"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://*.missena.xyz/*"
              },
              {
                "type": 1,
                "string": "https://*.instantrecall.me/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___TESTS___

scenarios: []


___NOTES___

Created on 27/09/2021, 17:11:36


